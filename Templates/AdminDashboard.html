<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <style>
        table { border-collapse: collapse; width: 80%; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        input[type="submit"]:disabled { background-color: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <h2>Admin Dashboard</h2>
    <p><a href="/admin/logout">Logout</a></p>

    <!-- Exams Section -->
    <h3>Exams</h3>
    <table>
        <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Action</th>
        </tr>
        {% for exam in exams %}
        <tr>
            <td>{{ exam.name }}</td>
            <td>{{ exam.descriptions }}</td>
            <td><a href="/admin/delete_exam/{{ exam.id }}">Delete</a></td>
        </tr>
        {% endfor %}
    </table>

    <form method="POST" action="/admin/add_exam">
        <input type="text" name="name" placeholder="Exam Name" required>
        <input type="text" name="description" placeholder="Description">
        <input type="submit" value="Add Exam">
    </form>

    <!-- Locations Section -->
    <h3>Locations</h3>
    <table>
        <tr>
            <th>Campus</th>
            <th>Room</th>
            <th>Action</th>
        </tr>
        {% for loc in locations %}
        <tr>
            <td>{{ loc.campus_name }}</td>
            <td>{{ loc.room_number }}</td>
            <td><a href="/admin/delete_location/{{ loc.id }}">Delete</a></td>
        </tr>
        {% endfor %}
    </table>

    <form method="POST" action="/admin/add_location">
        <select name="campus_name" required>
            <option value="">-- Select Campus --</option>
            <option value="Henderson">Henderson</option>
            <option value="North Las Vegas">North Las Vegas</option>
            <option value="West Charleston">West Charleston</option>
        </select>
        <input type="text" name="room_number" placeholder="Room Number" required>
        <input type="submit" value="Add Location">
    </form>

    <!-- Assign Proctors Section -->
    <h3>Assign Proctors</h3>
    <form method="POST" action="/admin/assign_proctor">
        <select name="location_id" id="locationSelect" required>
            <option value="">-- Select Location --</option>
            {% for loc in locations %}
            <option value="{{ loc.id }}">{{ loc.campus_name }} - {{ loc.room_number }}</option>
            {% endfor %}
        </select>

        <select name="proctor_id" id="proctorSelect" required>
            <option value="">-- Select Proctor --</option>
            {% for user in proctors %}
            <option value="{{ user.id }}">{{ user.full_name }}</option>
            {% endfor %}
        </select>

        <input type="submit" value="Assign Proctor" id="assignButton" disabled>
    </form>
    
    <h3>Student Registrations</h3>
    <table>
        <tr>
            <th>Student Name</th>
            <th>Email</th>
            <th>Registered Exams</th>
        </tr>
        {% for entry in student_data %}
        <tr>
            <td>{{ entry.student.full_name }}</td>
            <td>{{ entry.student.email }}</td>
            <td>
                <select>
                    {% if entry.exams %}
                        {% for exam in entry.exams %}
                            <option>
                                {{ exam.exam_name }} - {{ exam.campus_name }} - {{ exam.room_number }} - {{ exam.proctor_name or 'No Proctor' }}
                            </option>
                        {% endfor %}
                    {% else %}
                        <option>No exams scheduled</option>
                    {% endif %}
                </select>
            </td>
        </tr>
        {% endfor %}
    </table>

    <script>
        const locationSelect = document.getElementById('locationSelect');
        const proctorSelect = document.getElementById('proctorSelect');
        const assignButton = document.getElementById('assignButton');

        function updateButtonState() {
            if (locationSelect.value && proctorSelect.value) {
                assignButton.disabled = false;
            } else {
                assignButton.disabled = true;
            }
        }

        locationSelect.addEventListener('change', updateButtonState);
        proctorSelect.addEventListener('change', updateButtonState);
    </script>
</body>
</html>
